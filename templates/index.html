<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Panel Twitch Clips</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Panel Twitch Clips</h1>
      <div class="buttons">
        <button id="btn-update" class="btn">Od≈õwie≈º streamer√≥w</button>
        <button id="btn-report" class="btn">Generuj raport</button>
      </div>
      <div id="status" class="status"></div>
    </header>

    <!-- Tu wstrzykniemy raport -->
    <main id="raport-container" class="raport-container"></main>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const raportEl = document.getElementById('raport-container');

    document.getElementById('btn-update').onclick = async () => {
      statusEl.textContent = 'üîÑ Od≈õwie≈ºanie streamer√≥w‚Ä¶';
      try {
        let r = await fetch('/api/update-streamers');
        let obj = await r.json();
        statusEl.textContent = obj.message || obj.error;
      } catch(e) {
        statusEl.textContent = 'B≈ÇƒÖd: ' + e;
      }
    };

    document.getElementById('btn-report').onclick = async () => {
      statusEl.textContent = 'üïí Rozpoczynam generowanie‚Ä¶';
      // 1) uruchom generator w tle
      await fetch('/api/generate-raport');
      // 2) polling
      statusEl.textContent = 'üîç Generowanie raportu‚Ä¶';
      const interval = setInterval(async () => {
        let readyRes = await fetch('/api/report-ready');
        let { ready } = await readyRes.json();
        if (ready) {
          clearInterval(interval);
          statusEl.textContent = '‚úÖ Raport gotowy!';
          // 3) pobierz HTML i wstaw do kontenera
          let html = await fetch('/raport').then(r => r.text());
          raportEl.innerHTML = html;
          // opcjonalnie przewi≈Ñ do raportu
          raportEl.scrollIntoView({ behavior: 'smooth' });
        }
      }, 5000);
    };
  </script>
</body>
</html>
